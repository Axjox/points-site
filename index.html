<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>DÃ©fis + Classement</title>
<style>
    html, body {
        height: 100%;
        margin: 0;
        font-family: Arial, sans-serif;
        background: #f0f0f0;
    }

    body {
        display: flex;
        flex-direction: row;
        height: 100vh;
    }

    /* Colonnes dÃ©fis : 2 Ã  gauche, 2 Ã  droite */
    .challenge-column {
        flex: 1;
        padding: 10px;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
    }

    .challenge-day {
        padding: 5px;
        font-size: 14px;
        margin-bottom: 5px;
    }

    /* Centre : dÃ©fi du jour + classement */
    .center-column {
        flex: 2;
        padding: 10px;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
    }

    #defiDuJour {
        background: #fff7db;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 6px;
        border: 1px solid #e6d28c;
        font-size: 18px;
        flex-shrink: 0;
    }

    .item {
        margin-bottom: 10px;
    }

    .label {
        font-weight: bold;
        margin-bottom: 3px;
    }

    .bar-container {
        background: #ddd;
        height: 20px;
        border-radius: 10px;
        overflow: hidden;
    }

    .bar {
        height: 100%;
        border-radius: 10px;
    }

</style>
</head>
<body>

<!-- 2 colonnes gauche -->
<div class="challenge-column" id="colA"></div>
<div class="challenge-column" id="colB"></div>

<!-- centre -->
<div class="center-column">
    <div id="defiDuJour">Chargement...</div>
    <div id="container"></div>
</div>

<!-- 2 colonnes droite -->
<div class="challenge-column" id="colC"></div>
<div class="challenge-column" id="colD"></div>

<script>
const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/1tOqRdsHlJ2QkALVR2xLdnlMRfn8IfcjNSXZ96Ldak3Y/export?format=csv";
const TOTAL_DAYS = 24;
const TODAY = 7;

async function fetchSheet() {
    const res = await fetch(SHEET_CSV_URL);
    const txt = await res.text();
    const rows = txt.trim().split("\n").map(r => r.split(","));

    const challengeMap = {};
    const classement = [];

    rows.forEach(r => {
        const n = Number(r[0]);
        if (!isNaN(n) && n >=1 && n <= TOTAL_DAYS) {
            challengeMap[n] = r[1] || "";
        } else {
            const pts = Number(r[1]);
            if (!isNaN(pts)) {
                classement.push({
                    name: r[0],
                    points: pts,
                    defi_fait: r[2] || ""
                });
            }
        }
    });

    return { challengeMap, classement };
}

function renderChallengeColumns(map) {
    const colA = document.getElementById("colA");
    const colB = document.getElementById("colB");
    const colC = document.getElementById("colC");
    const colD = document.getElementById("colD");

    colA.innerHTML = ""; colB.innerHTML = ""; colC.innerHTML = ""; colD.innerHTML = "";

    function fillColumn(col, start, end) {
        for (let d = start; d <= end; d++) {
            const div = document.createElement("div");
            div.className = "challenge-day";
            div.textContent = `Jour ${d}: ${map[d] || "â€” Pas dÃ©fini"}`;
            col.appendChild(div);
        }
    }

    fillColumn(colA,1,6);
    fillColumn(colB,7,12);
    fillColumn(colC,13,18);
    fillColumn(colD,19,24);
}

function renderClassement(list) {
    const container = document.getElementById("container");
    container.innerHTML = "";

    list.sort((a,b)=>b.points-a.points);
    const max = list[0]?.points || 1;

    list.forEach((item,index)=>{
        let color="#4CAF50", medal="";
        if(index===0){ color="#FFD700"; medal="ðŸ¥‡ "; }
        else if(index===1){ color="#C0C0C0"; medal="ðŸ¥ˆ "; }
        else if(index===2){ color="#CD7F32"; medal="ðŸ¥‰ "; }

        const div=document.createElement("div");
        div.className="item";
        div.innerHTML=`
            <div class="label">${medal}${item.name} â€” ${item.points} pts</div>
            <div class="bar-container">
                <div class="bar" style="width:${(item.points/max)*100}%; background:${color};"></div>
            </div>
            <div>${item.defi_fait}</div>
        `;
        container.appendChild(div);
    });
}

function renderToday(map){
    document.getElementById("defiDuJour").textContent= map[TODAY] || "Aucun dÃ©fi pour aujourd'hui.";
}

async function refreshAll(){
    const {challengeMap, classement} = await fetchSheet();
    renderChallengeColumns(challengeMap);
    renderClassement(classement);
    renderToday(challengeMap);
}

refreshAll();
setInterval(refreshAll,5000);
</script>

</body>
</html>
