<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>DÃ©fis + Classement</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f0f0f0;
        margin: 0;
        padding: 20px;
        display: grid;
        grid-template-columns: 1fr 1fr 1.3fr 1fr 1fr;
        gap: 15px;
    }

    /* Colonnes des dÃ©fis */
    .side-column {
        background: #ffffff;
        padding: 15px;
        border-radius: 12px;
        max-height: 95vh;
        overflow-y: auto;
        box-shadow: 0 3px 6px rgba(0,0,0,0.15);
    }

    /* Centre (dÃ©fi du jour + classement) */
    .center-column {
        background: #ffffff;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 3px 6px rgba(0,0,0,0.15);
        max-height: 95vh;
        overflow-y: auto;
    }

    /* Box dÃ©fi */
    .day-box {
        background: #fafafa;
        border: 1px solid #ddd;
        padding: 10px;
        border-radius: 8px;
        margin-bottom: 8px;
        font-size: 15px;
    }

    .day-num {
        font-weight: bold;
        margin-bottom: 5px;
    }

    /* DÃ©fi du jour */
    #defiDuJour {
        background: #fff7db;
        border: 1px solid #e6d28c;
        padding: 12px;
        border-radius: 8px;
        font-size: 18px;
        margin-bottom: 20px;
    }

    /* Classement */
    .item {
        margin-bottom: 20px;
    }

    .label {
        font-weight: bold;
        margin-bottom: 5px;
    }

    .bar-container {
        background: #ddd;
        border-radius: 10px;
        width: 100%;
        height: 20px;
        overflow: hidden;
    }

    .bar {
        height: 100%;
        border-radius: 10px;
    }
</style>
</head>

<body>

<div class="side-column" id="colA"></div>
<div class="side-column" id="colB"></div>

<div class="center-column">
    <h2>DÃ©fi du jour</h2>
    <div id="defiDuJour">Chargement...</div>

    <h2>Classement</h2>
    <div id="container"></div>
</div>

<div class="side-column" id="colC"></div>
<div class="side-column" id="colD"></div>

<script>
// ==============================
// CONFIGURATION
// ==============================
const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/1tOqRdsHlJ2QkALVR2xLdnlMRfn8IfcjNSXZ96Ldak3Y/export?format=csv";
const TOTAL_DAYS = 24;
const TODAY = 7;

// ==============================
// LECTURE DU TABLEUR
// ==============================
async function fetchSheet() {
    const res = await fetch(SHEET_CSV_URL);
    const txt = await res.text();
    const rows = txt.trim().split("\n").map(r => r.split(","));

    const challengeMap = {};
    const classement = [];

    rows.forEach(r => {
        const n = Number(r[0]);

        // DÃ©fis
        if (!isNaN(n) && n >= 1 && n <= TOTAL_DAYS) {
            challengeMap[n] = r[1] || "";
        } 
        // Classement
        else {
            const pts = Number(r[1]);
            if (!isNaN(pts)) {
                classement.push({
                    name: r[0],
                    points: pts,
                    defi_fait: r[2] || ""
                });
            }
        }
    });

    return { challengeMap, classement };
}

// ==============================
// AFFICHAGE DES 4 COLONNES DE DÃ‰FIS
// ==============================
function renderChallengeColumns(map) {
    const colA = document.getElementById("colA");
    const colB = document.getElementById("colB");
    const colC = document.getElementById("colC");
    const colD = document.getElementById("colD");

    colA.innerHTML = "";
    colB.innerHTML = "";
    colC.innerHTML = "";
    colD.innerHTML = "";

    // RÃ©partition : 6 dÃ©fis par colonne (24 / 4)
    const groups = {
        A: [1, 6],
        B: [7, 12],
        C: [13, 18],
        D: [19, 24]
    };

    function fillColumn(col, start, end) {
        for (let d = start; d <= end; d++) {
            const div = document.createElement("div");
            div.className = "day-box";

            div.innerHTML = `
                <div class="day-num">Jour ${d}</div>
                <div>${map[d] || "â€” Pas dÃ©fini"}</div>
            `;
            col.appendChild(div);
        }
    }

    fillColumn(colA, 1, 6);
    fillColumn(colB, 7, 12);
    fillColumn(colC, 13, 18);
    fillColumn(colD, 19, 24);
}

// ==============================
// AFFICHAGE DU CLASSEMENT
// ==============================
function renderClassement(list) {
    const container = document.getElementById("container");
    container.innerHTML = "";

    list.sort((a, b) => b.points - a.points);
    const max = list[0]?.points || 1;

    list.forEach((item, index) => {
        let color = "#4CAF50";
        let medal = "";

        if (index === 0) { color = "#FFD700"; medal = "ðŸ¥‡ "; }
        else if (index === 1) { color = "#C0C0C0"; medal = "ðŸ¥ˆ "; }
        else if (index === 2) { color = "#CD7F32"; medal = "ðŸ¥‰ "; }

        container.innerHTML += `
            <div class="item">
                <div class="label">${medal}${item.name} â€” ${item.points} pts</div>
                <div class="bar-container">
                    <div class="bar" style="width:${(item.points/max)*100}%; background:${color};"></div>
                </div>
                <div>${item.defi_fait}</div>
            </div>
        `;
    });
}

// ==============================
// DÃ‰FI DU JOUR
// ==============================
function renderToday(map) {
    document.getElementById("defiDuJour").textContent =
        map[TODAY] || "Aucun dÃ©fi pour aujourd'hui.";
}

// ==============================
// RAFRAÃŽCHISSEMENT GLOBAL
// ==============================
async function refreshAll() {
    const { challengeMap, classement } = await fetchSheet();

    renderChallengeColumns(challengeMap);
    renderClassement(classement);
    renderToday(challengeMap);
}

refreshAll();
setInterval(refreshAll, 5000);
</script>

</body>
</html>
